# Безопасность

## Реализованные меры защиты

### 1. Аутентификация и авторизация

- JWT токены с истечением срока действия
- Хеширование паролей с помощью bcrypt
- Защита всех admin роутов через middleware `authenticateToken`
- Нормализация email при входе

### 2. Валидация входных данных

- Валидация с помощью Zod схем
- Санитизация всех входных данных (удаление опасных символов)
- Проверка типов данных перед обработкой

### 3. Защита от SQL-инъекций

- Использование параметризованных запросов (prepared statements)
- Все пользовательские данные передаются через параметры `$1, $2, ...`

### 4. Защита файловых загрузок

- Проверка расширения файла
- Проверка MIME типа
- Проверка magic bytes (реальный тип файла)
- Защита от path traversal атак
- Ограничение размера файла (5-10MB)
- Генерация уникальных имен файлов

### 5. Rate Limiting

- Логин: 5 попыток за 15 минут
- API запросы: 100 запросов в минуту
- Загрузка файлов: 10 загрузок в минуту

### 6. Security Headers

- X-Content-Type-Options: nosniff
- X-Frame-Options: DENY
- X-XSS-Protection: 1; mode=block
- Content-Security-Policy
- Referrer-Policy: strict-origin-when-cross-origin

### 7. CORS

- Ограничение источников запросов
- Разрешенные методы: GET, POST, PUT, DELETE, OPTIONS
- Разрешенные заголовки: Content-Type, Authorization

### 8. Обработка ошибок

- Единый обработчик ошибок
- Не раскрываются детали ошибок в production
- Логирование ошибок для отладки

### 9. Защита от NoSQL инъекций

- Санитизация объектов (удаление операторов MongoDB)

## Рекомендации для production

1. **Переменные окружения:**

   - Используйте сильный `JWT_SECRET` (минимум 32 символа)
   - Настройте `FRONTEND_URL` для production
   - Используйте переменные окружения для всех секретов

2. **HTTPS:**

   - Всегда используйте HTTPS в production
   - Настройте SSL/TLS сертификаты

3. **База данных:**

   - Используйте отдельного пользователя БД с минимальными правами
   - Регулярно делайте бэкапы
   - Используйте connection pooling

4. **Мониторинг:**

   - Настройте логирование всех запросов
   - Мониторьте подозрительную активность
   - Настройте алерты на множественные неудачные попытки входа

5. **Обновления:**
   - Регулярно обновляйте зависимости
   - Проверяйте уязвимости: `npm audit`

## Проверка безопасности

```bash
# Проверка уязвимостей в зависимостях
npm audit

# Исправление автоматически исправимых уязвимостей
npm audit fix
```
